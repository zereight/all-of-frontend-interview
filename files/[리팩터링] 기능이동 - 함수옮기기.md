# 기능이동 - 함수 옮기기



지금 까지는 프로그램 요소를 생성 혹은 제거하거나 이름을 변경하는 리팩터링을 다뤘다.

여기에 더해서 요소를 클래스나 모듈로 옮기는 일 역시 리팩터링의 중요한 축이다.

다른 클래스나 모듈로 함수로 옮길 때에는 함수 옮기기를 사용한다.

필드 역시 필드 옮기기로 옮길 수 있다.



옮기기는 문장 단위에서도 이뤄진다.

문장을 함수안이나 바깥으로 옮길 때는 문장을 함수로 옮기기나 문장을 호출한 곳으로 옮기기를 사용한다.

같은 함수 안에서 옮길 때에는 문장 슬라이드하기를 사용한다.

때로는 한 덩어리의 문장들이 기존 함수와 같은 일을 할 때가 있다. 이럴 때는 인라인 코드를 함수 호출로 바꾸기를 적용해서 중복을 제거한다.



반복문과 관련하여 자주 사용하는 리팩터링은 2가지이다.

첫번째는 각각의 반복문이 단 하나의 일만 수행하도록 보장하는 반복문 쪼개기이고, 두번 째는 반복문을 완전히 없애버리는 반복문을 파이프라인으로 바꾸기이다.



마지막으로 많은 훌륭한 프로그래머가 즐겨 사용하는 리팩터링인 죽은 코드 제거하기가 있다.

필요없는 문장들을 디지털 화염방사기로 태워버리는 것만큼 짜릿한 일도 없다.



## 함수 옮기기



#### 배경

좋은 소프트웨어의 설계의 핵심은 모듈화가 얼마나 잘되어 있느냐를 뜻하는 모듈성이다.

모듈성이란 프로그램의 어딘가를 수정하려 할 때 해당 기능과 값이 관련된 작은 일부만 이해해도 가능하게 해주는 능력이다.

모듈성을 높이려면 서로 연관된 요소들을 함께 묶고, 요소 사이의 연결관계를 쉽게 찾고 이해할 수 있도록 해야한다.

하지만 프로그램을 얼마나 잘 이해했느냐에 따라서 구체적인 방법이 달라질 수 있다. 보통은 이해도가 높아질수록 소프트웨어 요소들을 더 잘 묶는 새로운 방법을 깨우치게 된다.

그래서 높아진 이해를 반영하려면 요소들을 이리저리 옮겨야할 수 있다.

모든 함수는 어떤 컨텍스트 안에 존재한다. 전역 함수도 있지만 대부분은 특정 모듈에 속한다. 객체 지향 프로그래밍의 핵심 모듈화 컨텍스트는 클래스이다. 또한 함수를 다른 함수에 중첩시켜도 또 다른 공통 컨텍스트를 만들게 된다.

프로그래밍 언어들은 저마다의 모듈화 수단을 제공하며, 각각의 수단이 함수가 살아 숨쉬는 컨텍스트를 만들어준다.

어떤 함수가 자신이 속한 모듈 A의 요소들보다 다른 모듈 B의 요소들을 더 많이 참조한다면 모듈 B로 옮겨주어야 마땅하다. 이렇게하면 캡슐화가 좋아져서 이 소프트웨어의 나머지 부분은 모듈 B의 세뷰사항에 덜 의존하게 된다.



이와 비슷하게, 호출자들의 현재 위치나 다음 업데이트 때 바뀌리라 예상되는 위치에 따라서도 함수를 옮겨야할 수 있다.

예컨대 다른 함수 안에서 도우미 역할로 정의된 함수 중 독립적으로 고유한 가치가 있는 것은 접근하기 더 쉬운 장소로 옮기는 것이 낫다. 또한 다른 클래스로 옮겨두면 사용하기 더 편한 메서드도 있다.

함수를 옮길지 말지를 정하기란 쉽지 않다.

그럴 땐 대상함수의 현재 컨텍스트와 후보 컨텍스트를 둘러보면 도움이 된다. 대상 함수를 호출하는 함수들은 무엇인지, 대상 함수가 호출하는 함수들은 도 무엇이 있는지, 대상 함수가 사용하는 데이터는 무엇인지를 살펴보아야 한다.

서로 관련된 여러 함수를 묶을 새로운 컨텍스트가 필요해질 때도 많은데, 이럴 때는 여러 함수를 클래스로 묶기나 클래스 추출하기로 해결할 수 있다.

함수의 최적 장소를 정하기가 어려울 수 있으나, 선택이 어려울수록 큰 문제가 아닌 경우가 많다.

경험상 함수들을 한 컨텍스트에 두고 작업해보는 것도 괜찮다.

그곳이 얼마나 적합한지는 차차 깨달아갈 것임을 알고 있고, 잘 맞지 않는다고 판단되면 위치는 언제든 옮길 수 있으니 말이다.



#### 절차

1. 선택한 함수가 현재 컨텍스트에서 사용중인 모든 프로그램 요소를 살펴본다. 이 요소들 중에도 함께 옮겨야 할 게 있는지 고민해본다.
2. 선택한 함수가 다형 메서드인지 확인한다.
3. 선택한 함수를 타깃 컨텍스트로 복사한다. 타깃 함수가 새로운 터전에 잘 자리 잡도록 다듬는다.
4. 정적 분석을 수행한다.
5. 소스 컨텍스트에서 타깃 함수를 참조할 방법을 찾아 반영한다.
6. 소스 함수를 타깃 함수의 위임함수가 되도록 수정한다.
7. 테스트한다.
8. 소스 함수를 인라인할지 고민한다.



